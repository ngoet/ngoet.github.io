<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Creating an Item Bank for IRT analysis in R | Niels Goet Data Scientist</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Creating an Item Bank for IRT analysis in R" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Item Response Theory (IRT) is a powerful tool that is the workhorse in many psychometric applications. It allows us to estimate the ability of test-takers, while important item parameters such as discrimination1 and difficulty remain stable across samples (Lord 1980). Many R libraries exist today that help researchers simulate the necessary data and to estimate a wide variety of IRT models, including mirt, ltm, and catR (for an excellent overview of available R packages for IRT modelling, see this paper)." />
<meta property="og:description" content="Item Response Theory (IRT) is a powerful tool that is the workhorse in many psychometric applications. It allows us to estimate the ability of test-takers, while important item parameters such as discrimination1 and difficulty remain stable across samples (Lord 1980). Many R libraries exist today that help researchers simulate the necessary data and to estimate a wide variety of IRT models, including mirt, ltm, and catR (for an excellent overview of available R packages for IRT modelling, see this paper)." />
<link rel="canonical" href="http://localhost:4000/irt/2018/03/10/IRT-simulation.html" />
<meta property="og:url" content="http://localhost:4000/irt/2018/03/10/IRT-simulation.html" />
<meta property="og:site_name" content="Niels Goet Data Scientist" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-10T16:45:49+01:00" />
<script type="application/ld+json">
{"description":"Item Response Theory (IRT) is a powerful tool that is the workhorse in many psychometric applications. It allows us to estimate the ability of test-takers, while important item parameters such as discrimination1 and difficulty remain stable across samples (Lord 1980). Many R libraries exist today that help researchers simulate the necessary data and to estimate a wide variety of IRT models, including mirt, ltm, and catR (for an excellent overview of available R packages for IRT modelling, see this paper).","@type":"BlogPosting","url":"http://localhost:4000/irt/2018/03/10/IRT-simulation.html","headline":"Creating an Item Bank for IRT analysis in R","dateModified":"2018-03-10T16:45:49+01:00","datePublished":"2018-03-10T16:45:49+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/irt/2018/03/10/IRT-simulation.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/assets/main.css">
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Niels Goet | Data Scientist" />
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" rel="author" href="/">Niels Goet | Data Scientist</a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/blog/">Blog</a>
            
          
            
            
            <a class="page-link" href="/cv/">CV</a>
            
          
            
            
            <a class="page-link" href="/data/">Data</a>
            
          
            
            
          
            
            
            <a class="page-link" href="/publications/">Publications</a>
            
          
            
            
            <a class="page-link" href="/research/">Research</a>
            
          
            
            
            <a class="page-link" href="/teaching/">Teaching</a>
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Creating an Item Bank for IRT analysis in R</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-03-10T16:45:49+01:00" itemprop="datePublished">
        
        Mar 10, 2018
      </time>
      </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Item Response Theory (IRT) is a powerful tool that is the workhorse in many psychometric applications. It allows us to estimate the ability of test-takers, while important item parameters such as discrimination<sup><a href="#myfootnote1">1</a></sup> and difficulty remain stable across samples (<a href="https://books.google.no/books/about/Applications_of_Item_Response_Theory_to.html?id=7YhqAAAAMAAJ&amp;redir_esc=y">Lord 1980</a>). Many R libraries exist today that help researchers simulate the necessary data and to estimate a wide variety of IRT models, including <a href="https://www.jstatsoft.org/article/view/v048i06/v48i06.pdf">mirt</a>, <a href="https://www.jstatsoft.org/article/view/v017i05">ltm</a>, and <a href="https://www.jstatsoft.org/article/view/v048i08">catR</a> (for an excellent overview of available R packages for IRT modelling, see <a href="http://epub.wu.ac.at/4010/1/resrepIRThandbook.pdf">this paper</a>).</p>

<p>Yet, to fully understand what is going on “under the hood”, it is good practice to try to build some of the components that are needed for simulation of IRT models oneself. In this blog post, I go through the process of writing a simple code to generate an item bank with both dichotomous and polytomous items for 2-parameter logistic (2PL) and 3-parameter logistic (3PL) models.<sup><a href="#myfootnote2">2</a></sup> Here, the item bank is specifically intended for a graded response model (<a href="https://link.springer.com/chapter/10.1007/978-1-4757-2691-6_5">GRM; Samejima 1997</a>), which is designed for <em>ordered</em> categories (e.g. “strongy agree, agree, disagree, strongly disagree”).</p>

<h1 id="what-is-an-item-bank">What is an Item Bank?</h1>
<p>An item bank is a (preferably large) set of questions that have been calibrated (i.e. of which item parameters have been estimated). Such item parameters include key information about, for example, how appropriate a question is for an examinee (or learner) with a particular level of ability (difficulty), how much of the probability of success is due to guessing, or how well a question distinguishes between low- and high-ability students (“discrimination”). Subsequently, several different algorithms can be used to define tests on the basis of these item parameters. These algorithms are used to, for example, deliver linear-on-the-fly testing (LOFT), where several different (and comparable) permutations of a test are created prior to a test session, or computerised adaptive testing (CAT), where examinees take a fully adaptive test where the next item is selected on the estimated ability of the candidate at that time.</p>

<h1 id="building-an-item-bank-with-r">Building an Item Bank with R</h1>
<p>R has powerful in-built functions that allow us to build a new, custom item bank generation function with relative ease. The full code for the the function written for this post can be found <a href="https://github.com/ngoet/IRTSimulationR">in this repo on my github page</a>. Here, I go through the process of writing this code step by step.</p>

<h4 id="step-1-define-the-function-name-and-parameters">Step 1: Define the function name and parameters</h4>
<p>First, we choose a name for our function, and decide how many parameters it will take. Here, I have chosen the inspired name “<code class="highlighter-rouge">generateItembank</code>” for my function, which takes three parameters:</p>
<ol>
  <li><code class="highlighter-rouge">nItems</code> (i.e. the total number of items to be generated for the item bank);</li>
  <li><code class="highlighter-rouge">maxOptions</code> (i.e. an integer value that represents the maximum number of response categories);</li>
  <li>A <code class="highlighter-rouge">model</code> parameter (string value: “2PL” or “3PL”; default = “2PL”) that tells the function what item parameters to generate.</li>
</ol>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">generateItembank</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">nItems</span><span class="p">,</span><span class="w"> </span><span class="n">maxOptions</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">){</span><span class="w">
  
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="step-2-parameter-checks">Step 2: Parameter checks</h4>
<p>Naturally, we want to makes sure that users provide the right input for the three parameters that go into the function. So, our next step is to define a couple of “checks”. For <code class="highlighter-rouge">nItems</code> and <code class="highlighter-rouge">maxOptions</code> we verify that the user input is an integer, using the <code class="highlighter-rouge">is.wholenumber()</code> function. For the <code class="highlighter-rouge">model</code> variable, we simply check that the input is either “2PL” or “3PL”. If any of these conditions is not met, the function will <code class="highlighter-rouge">stop</code> and display an error message.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">generateItembank</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">nItems</span><span class="p">,</span><span class="w"> </span><span class="n">maxOptions</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">){</span><span class="w">
  
  </span><span class="n">is.wholenumber</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.Machine</span><span class="o">$</span><span class="n">double.eps</span><span class="o">^</span><span class="m">0.5</span><span class="p">)</span><span class="w">  </span><span class="nf">abs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tol</span><span class="w">
  
  </span><span class="c1">#check entered parameters</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">is.wholenumber</span><span class="p">(</span><span class="n">nItems</span><span class="p">)){</span><span class="w">
    </span><span class="n">stop</span><span class="p">(</span><span class="s2">"Error. Please enter an integer value for the nItems variable."</span><span class="p">)</span><span class="w">
    
  </span><span class="p">}</span><span class="w">
  
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">is.wholenumber</span><span class="p">(</span><span class="n">maxOptions</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">maxOptions</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">1</span><span class="p">){</span><span class="w">
    </span><span class="n">stop</span><span class="p">(</span><span class="s2">"Error. Please enter a maxOptions between 1 and infinity."</span><span class="p">)</span><span class="w">
    
  </span><span class="p">}</span><span class="w">
  
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">model</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"2PL"</span><span class="p">,</span><span class="s2">"3PL"</span><span class="p">)){</span><span class="w">
    </span><span class="n">stop</span><span class="p">(</span><span class="s2">"Error. Please enter a valid option for the model parameter (2PL/3PL)"</span><span class="p">)</span><span class="w">
    
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="step-3-generate-the-item-parameters">Step 3: Generate the item parameters</h4>
<p>Next up: generating the item parameters for the items that go into our “bank”. In case we want to run a “2PL” model at some late stage, we only need discrimination and difficulty parameters (see above); if instead we want a “3PL” model, we should also include a parameter to account for guessing. In the code snippet below, we generate a vector of (normally distributed) discrimination parameters (stored in the object <code class="highlighter-rouge">a1</code>), using R’s native <code class="highlighter-rouge">rlnorm()</code> function. We generate a difficulty parameter to distinguish between each response level, using <code class="highlighter-rouge">rnorm()</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="c1">#specify discrimination parameter </span><span class="w">
  </span><span class="n">a</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rlnorm</span><span class="p">(</span><span class="n">nItems</span><span class="p">,</span><span class="w"> </span><span class="m">.2</span><span class="p">,</span><span class="m">.2</span><span class="p">)</span><span class="w">
  
  </span><span class="n">numBParam</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">maxOptions</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="w">
  
  </span><span class="k">if</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"2PL"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">is.null</span><span class="p">(</span><span class="n">model</span><span class="p">)){</span><span class="w">
    
    </span><span class="c1">#initialise item bank</span><span class="w">
    </span><span class="n">itemBank</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numBParam</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nItems</span><span class="p">))</span><span class="w">  
    
    </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">numBParam</span><span class="p">){</span><span class="w">
      </span><span class="n">itemBank</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">nItems</span><span class="p">)</span><span class="w">
      
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c1">#add discrimination parameter</span><span class="w">
    </span><span class="n">library</span><span class="p">(</span><span class="n">tibble</span><span class="p">)</span><span class="w">
    </span><span class="n">itemBank</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">add_column</span><span class="p">(</span><span class="n">itemBank</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">.before</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"X1"</span><span class="p">)</span><span class="w">
    
    </span><span class="c1">#change column names</span><span class="w">
    </span><span class="n">colnames</span><span class="p">(</span><span class="n">itemBank</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"X"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">,</span><span class="n">colnames</span><span class="p">(</span><span class="n">itemBank</span><span class="p">))</span><span class="w">
    
  </span><span class="p">}</span><span class="w">
  
  </span><span class="k">if</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"3PL"</span><span class="p">){</span><span class="w">
    
    </span><span class="c1">#initialise item bank </span><span class="w">
    </span><span class="n">itemBank</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numBParam</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nItems</span><span class="p">))</span><span class="w">
    
    </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">numBParam</span><span class="p">){</span><span class="w">
      </span><span class="n">itemBank</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">nItems</span><span class="p">)</span><span class="w">
      
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c1">#add guessing</span><span class="w">
    </span><span class="n">g</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbeta</span><span class="p">(</span><span class="n">nItems</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">80</span><span class="p">)</span><span class="w">
    
    </span><span class="c1">#add discrimination parameter</span><span class="w">
    </span><span class="n">library</span><span class="p">(</span><span class="n">tibble</span><span class="p">)</span><span class="w">
    </span><span class="n">itemBank</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">add_column</span><span class="p">(</span><span class="n">itemBank</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">.before</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"X1"</span><span class="p">)</span><span class="w">
    
    </span><span class="c1">#change column names</span><span class="w">
    </span><span class="n">colnames</span><span class="p">(</span><span class="n">itemBank</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"X"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">,</span><span class="n">colnames</span><span class="p">(</span><span class="n">itemBank</span><span class="p">))</span><span class="w">
    
  </span><span class="p">}</span><span class="w"> 
  
 
</span></code></pre></div></div>

<h4 id="step-4-varying-the-number-of-responses">Step 4: Varying the number of responses</h4>
<p>To ensure that our item bank contains items with varying numbers of responses, we randomly insert <code class="highlighter-rouge">NA</code> values in each row, starting from the right. That is, provided that the number of response categories exceeds one, we introduce missing values with some probability to each difficulty parameter column (here p = 0.15), excluding the first column (as we naturally always want to have at least one parameter).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> #randomly insert NA as per maxOptions if maxOptions &gt; 1
  if(maxOptions &gt; 1){
    
    #go through each b column (starting with the last) and assign NAs
    #identify b columns
    bColumns &lt;- sort(grep("b",colnames(itemBank)),decreasing=T)
    bColumns &lt;- bColumns[bColumns!=min(bColumns)]
    
    for (column in bColumns){
      
      B &lt;- itemBank[,column]
      newB &lt;- unlist(lapply(B, function(cc) cc[ sample(c(TRUE, NA), 
      prob = c(0.85, 0.15), size = length(cc), replace = TRUE) ]))
      
      #assign appropriate place in item bank
      itemBank[,column] &lt;- newB
      
      #update item bank
      itemBank[is.na(itemBank[,column]), !colnames(itemBank) %in% 
      c(paste("b",as.numeric(gsub("[^\\d]+","", colnames(itemBank)[column], 
      perl=TRUE))-1,sep=""),"b1","g","a1")] &lt;- NA
      
    }
  }
  
</code></pre></div></div>

<h4 id="step-5-running-our-custom-function">Step 5: Running our custom function</h4>
<p>And there you go: a custom function for creating your very own item bank. To use your own function in R, simply save it in a script (<code class="highlighter-rouge">myscript.R</code>), point your R session to this working directory, run the <code class="highlighter-rouge">source("myscript.R")</code> command, and use the function call with the appropriate input.</p>

<h2 id="notes">Notes</h2>
<p><a name="myfootnote1">1</a>. I.e. the ability of a question to distinguish between highly- and poorly-performing learners.</p>

<p><a name="myfootnote2">2</a>. The 2PL model only includes discrimination and difficulty parameters, whereas the 3PL also incudes a parameter to account for guessing.</p>


  </div>

  

  <a class="u-url" href="/irt/2018/03/10/IRT-simulation.html" hidden></a>
</article>

      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Niels Goet | Data Scientist</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">
            
              Niels Goet | Data Scientist
            
            </li>
            
            <li><a class="u-email" href="mailto:ndgoet [at] gmail.com">ndgoet [at] gmail.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
  
  
  
  <li><a href="https://github.com/ngoet"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ngoet</span></a></li>
  
  <li><a href="https://www.linkedin.com/in/niels-goet"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">niels-goet</span></a></li>
  
  <li><a href="https://www.twitter.com/NielsGoet"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">NielsGoet</span></a></li>
  
  
  
</ul>

      </div>

      <div class="footer-col footer-col-3">
        <p>Welcome to my personal website. I currently work as a data scientist at Inspera AS, an EdTech company based in Oslo, Norway. I use this website to blog about quantitative methods and programming, and to host sample code and data.</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
